<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç© DONUT Protocol Mining Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.org/v6/ethers.umd.min.js"></script>
    
    <style>
        /* Custom styles for the donut theme */
        .donut-primary { background-color: #FF7F50; } /* Coral-like color */
        .donut-secondary { background-color: #F8F8FF; } /* Ghost White */
        .donut-text { color: #FF7F50; }
        .bg-card { background-color: #2D3748; } /* Darker background for cards */

        /* Card fall-in animation */
        .fall-in {
            opacity: 0;
            transform: translateY(-40px) scale(0.96);
            transition: opacity 0.7s cubic-bezier(.5,1.5,.5,1), transform 0.7s cubic-bezier(.5,1.5,.5,1);
        }
        .fall-in.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Donut logo bounce */
        .donut-bounce {
            display: inline-block;
            animation: donutBounce 1.2s infinite cubic-bezier(.5,1.5,.5,1);
        }
        @keyframes donutBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            20% { transform: translateY(-10px) scale(1.08); }
            40% { transform: translateY(0) scale(0.98); }
            60% { transform: translateY(-6px) scale(1.04); }
            80% { transform: translateY(0) scale(1); }
        }

        /* Typewriter effect */
        .typewriter {
            display: inline-block;
            overflow: hidden;
            border-right: .12em solid #FF7F50;
            white-space: nowrap;
            animation: caret 1s steps(1) infinite;
        }
        @keyframes caret {
            0%, 100% { border-color: #FF7F50; }
            50% { border-color: transparent; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

    <nav class="sticky top-0 z-50 bg-gray-800/90 backdrop-blur-sm shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 text-2xl font-bold donut-text">
                        <span class="donut-bounce text-white">üç©</span> DONUT Hub
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#hero" class="text-white hover:text-donut-text px-3 py-2 rounded-md text-sm font-medium">Dashboard</a>
                        <a href="#how-it-works" class="text-gray-300 hover:text-donut-text px-3 py-2 rounded-md text-sm font-medium">How It Works</a>
                        <a href="#tools" class="text-gray-300 hover:text-donut-text px-3 py-2 rounded-md text-sm font-medium">Tools</a>
                        <a href="#analytics" class="text-gray-300 hover:text-donut-text px-3 py-2 rounded-md text-sm font-medium">Analytics</a>
                        <a href="#referral" class="text-gray-300 hover:text-donut-text px-3 py-2 rounded-md text-sm font-medium">Referral</a>
                    </div>
                </div>
                <div class="flex items-center">
                    <button id="connect-wallet-btn" onclick="connectWallet()" class="donut-primary text-white font-bold py-2 px-4 rounded-lg transition duration-300 hover:opacity-80">
                        Connect Wallet
                    </button>
                    <button class="ml-4 text-gray-300 border border-gray-500 py-2 px-4 rounded-lg text-sm transition duration-300 hover:border-donut-text hover:text-donut-text">
                        Trade DONUT
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="hero" class="py-20 text-center">
            <h1 class="text-6xl font-extrabold mb-4 leading-tight">
                Mine The Social Value of r/EthTrader. <span class="donut-text">Earn $DONUT.</span>
            </h1>
            <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-8">
                A single source for all DONUT-related staking, mining, governance, and decentralized applications. Start earning passive income today.
            </p>
                <div class="flex justify-center space-x-4 mb-12">
                <button id="start-mining-btn" onclick="handleStartMiningClick()" class="donut-primary text-white text-lg font-bold py-3 px-8 rounded-xl shadow-xl transition duration-300 transform hover:scale-105">
                    üöÄ Start Mining Now
                </button>
                <a href="#frontends" class="text-white bg-gray-700 text-lg font-bold py-3 px-8 rounded-xl shadow-lg transition duration-300 hover:bg-gray-600">
                    Explore All Frontends
                </a>
            </div>

            <div class="flex justify-center space-x-8 max-w-4xl mx-auto mt-10">
                <div class="bg-card p-6 rounded-xl shadow-2xl w-full">
                    <p class="text-3xl font-bold donut-text" id="donut-price">$0.0053</p>
                    <p class="text-gray-400 mt-1">DONUT Price (24h: +1.2%)</p>
                </div>
                <div class="bg-card p-6 rounded-xl shadow-2xl w-full">
                    <p class="text-3xl font-bold text-green-400" id="tvl-stat">$8.4M</p>
                    <p class="text-gray-400 mt-1">Total Value Locked (TVL)</p>
                </div>
                <div class="bg-card p-6 rounded-xl shadow-2xl w-full">
                    <p class="text-3xl font-bold text-yellow-400" id="apy-stat">~42% APY</p>
                    <p class="text-gray-400 mt-1">Highest Staking APY</p>
                </div>
            </div>
        </section>
        <!-- Mining Modal (hidden by default) -->
        <div id="mining-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60">
            <div class="bg-gray-800 rounded-xl p-6 w-full max-w-lg mx-4 shadow-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Start Mining</h3>
                    <button onclick="closeMiningModal()" class="text-gray-400 hover:text-white">‚úï</button>
                </div>

                <div id="mining-modal-body" class="space-y-4">
                    <p class="text-gray-400">You must connect your Web3 wallet to start mining.</p>

                    <div class="hidden" id="mining-form">
                        <label class="block text-sm text-gray-400 mb-1">Network</label>
                        <select id="network-select" class="mb-3 block w-full bg-gray-700 border border-gray-600 rounded-md p-2 text-white">
                            <option value="42170">Arbitrum Nova</option>
                            <option value="100">Gnosis Chain</option>
                        </select>
                                // --- Network Switching Logic ---
                                async function ensureNetwork(targetNetworkId) {
                                    if (!window.ethereum) return false;
                                    const hexChainId = '0x' + parseInt(targetNetworkId).toString(16);
                                    try {
                                        const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
                                        if (currentChainId === hexChainId) return true;
                                        // Try to switch
                                        await window.ethereum.request({
                                            method: 'wallet_switchEthereumChain',
                                            params: [{ chainId: hexChainId }]
                                        });
                                        return true;
                                    } catch (switchErr) {
                                        // If not added, try to add
                                        if (switchErr.code === 4902 && NETWORKS[targetNetworkId]) {
                                            const net = NETWORKS[targetNetworkId];
                                            try {
                                                await window.ethereum.request({
                                                    method: 'wallet_addEthereumChain',
                                                    params: [{
                                                        chainId: hexChainId,
                                                        chainName: net.name,
                                                        nativeCurrency: net.nativeCurrency,
                                                        rpcUrls: [net.rpcUrl],
                                                        blockExplorerUrls: [net.blockExplorer]
                                                    }]
                                                });
                                                return true;
                                            } catch (addErr) {
                                                alert('Failed to add network: ' + addErr.message);
                                                return false;
                                            }
                                        } else {
                                            alert('Failed to switch network: ' + switchErr.message);
                                            return false;
                                        }
                                    }
                                }
                        <label class="block text-sm text-gray-400">Amount (DONUT)</label>
                        <input id="mining-amount" type="number" value="100" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white">

                        <label class="block text-sm text-gray-400 mt-3">Staking Period (days)</label>
                        <input id="mining-period" type="number" value="30" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white">

                        <div class="mt-4 flex space-x-3">
                            <button onclick="performMiningAction()" id="confirm-mining-btn" class="donut-primary text-white font-bold py-2 px-4 rounded-lg">Start Mining</button>
                            <button onclick="closeMiningModal()" class="text-gray-300 border border-gray-600 py-2 px-4 rounded-lg">Cancel</button>
                        </div>
                    </div>

                    <div id="mining-notice" class="text-yellow-400"> </div>
                </div>
            </div>
        </div>
        
        <section id="how-it-works" class="py-20 bg-gray-900">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-4">üöÄ Getting Started in 3 Simple Steps</h2>
                <p class="text-xl text-center text-gray-400 mb-12">
                    Start mining, staking, and earning $DONUT today. It's permissionless, decentralized, and rewarding.
                </p>

                <div class="grid md:grid-cols-3 gap-8">
                    
                    <div class="group bg-card p-6 rounded-xl shadow-2xl transition duration-500 hover:scale-[1.03] hover:shadow-donut-text/50">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="text-4xl font-extrabold donut-text transition-transform duration-500 group-hover:rotate-12">1</div>
                            <h3 class="text-2xl font-semibold text-white">Connect & Bridge</h3>
                        </div>
                        <p class="text-gray-400 mb-4">
                            Connect your Web3 Wallet (MetaMask, Rainbow, etc.). Ensure your funds are bridged to the Arbitrum Nova or Gnosis Chain network for minimal fees.
                        </p>
                        <a href="#frontends" class="text-sm font-medium donut-text hover:underline transition duration-300 flex items-center">
                            View Bridge Guides & Networks ‚Üí
                        </a>
                    </div>

                    <div class="group bg-card p-6 rounded-xl shadow-2xl transition duration-550 hover:scale-[1.03] hover:shadow-yellow-400/50">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="text-4xl font-extrabold text-yellow-400 transition-transform duration-550 group-hover:scale-125">2</div>
                            <h3 class="text-2xl font-semibold text-white">Acquire $DONUT</h3>
                        </div>
                        <p class="text-gray-400 mb-4">
                            Swap ETH or USDC for $DONUT on Decentralized Exchanges (DEXs) like Uniswap or SushiSwap. You can also earn them by contributing to r/EthTrader.
                        </p>
                        <a href="#frontends" class="text-sm font-medium text-yellow-400 hover:underline transition duration-300 flex items-center">
                            Go to Trading Pools ‚Üí
                        </a>
                    </div>

                    <div class="group bg-card p-6 rounded-xl shadow-2xl transition duration-600 hover:scale-[1.03] hover:shadow-green-400/50">
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="text-4xl font-extrabold text-green-400 transition-transform duration-600 group-hover:animate-pulse">3</div>
                            <h3 class="text-2xl font-semibold text-white">Stake & Earn</h3>
                        </div>
                        <p class="text-gray-400 mb-4">
                            Deposit your $DONUT or $DONUT-ETH Liquidity Pool tokens into one of the official staking vaults to start earning fees and emission rewards.
                        </p>
                        <a href="#tools" class="text-sm font-medium text-green-400 hover:underline transition duration-300 flex items-center">
                            Run Earning Simulation ‚Üí
                        </a>
                    </div>
                </div>
                
                <div class="mt-16 text-center">
                    <div class="inline-block bg-gray-700 p-8 rounded-xl w-full max-w-4xl border border-gray-600">
                        <p class="text-gray-400 font-semibold mb-4">Need a visual guide?</p>
                        <div class="flex justify-center">
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/1MKPtB7w4oQ?si=x17LwLnMTRFNzjWa" title="YouTube video player" class="rounded-lg shadow-lg" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="frontends" class="py-20">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-12">üåê All Frontends & Ecosystem Platforms</h2>

                <div class="overflow-x-auto bg-card rounded-xl shadow-2xl">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th scope="col" class="px-3 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Platform
                                </th>
                                <th scope="col" class="px-3 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Use Case
                                </th>
                                <th scope="col" class="px-3 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Type
                                </th>
                                <th scope="col" class="px-3 py-4 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Link
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            
                            <tr class="hover:bg-gray-700 transition duration-150">
                                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-white">
                                    DONUT Miner App
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-300">
                                    Official Mining/Staking Interface
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-yellow-400">
                                    Frontend DApp
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm">
                                    <a href="https://github.com/Heesho/donut-miner-miniapp" target="_blank" class="donut-text hover:underline font-bold">
                                        View Code / Live App ‚Üí
                                    </a>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-700 transition duration-150">
                                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-white">
                                    r/EthTrader
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-300">
                                    Social Mining (Posting/Commenting)
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-blue-400">
                                    Social Platform
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm">
                                    <a href="https://www.reddit.com/r/ethtrader/" target="_blank" class="donut-text hover:underline font-bold">
                                        Start Contributing ‚Üí
                                    </a>
                                </td>
                            </tr>
                            
                            <tr class="hover:bg-gray-700 transition duration-150 bg-gray-700/50">
                                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-white">
                                    Dune Analytics Dashboard
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-300">
                                    Protocol Metrics & Visualization
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-green-400">
                                    Analytics
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm">
                                    <a href="https://dune.com/xyk/donut-company?theme=dark" target="_blank" class="text-green-400 hover:underline font-bold">
                                        View Dashboard ‚Üí
                                    </a>
                                </td>
                            </tr>

                            <tr class="hover:bg-gray-700 transition duration-150">
                                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-white">
                                    Subgraph Indexer
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-300">
                                    Queryable On-Chain Event Data
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-purple-400">
                                    Dev Tool
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm">
                                    <a href="https://github.com/Heesho/donut-miner-subgraph" target="_blank" class="text-purple-400 hover:underline font-bold">
                                        View Subgraph Code ‚Üí
                                    </a>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-700 transition duration-150">
                                <td class="px-3 py-4 whitespace-nowrap text-sm font-semibold text-white">
                                    Core Smart Contracts
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-300">
                                    Protocol Logic and Contracts
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm text-red-400">
                                    Dev Tool
                                </td>
                                <td class="px-3 py-4 whitespace-nowrap text-sm">
                                    <a href="https://github.com/Heesho/donut-miner" target="_blank" class="text-red-400 hover:underline font-bold">
                                        View Solidity Code ‚Üí
                                    </a>
                                </td>
                            </tr>
                            
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="tools" class="py-20 bg-gray-800">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-12">üßÆ Mining Tools: Strategy & Simulation</h2>

                <div class="grid md:grid-cols-2 gap-8">
                    
                    <div class="bg-card p-8 rounded-xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-3">Strategy Simulator</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="initial-donut" class="block text-sm font-medium text-gray-400">Initial DONUT Amount ($)</label>
                                <input type="number" id="initial-donut" value="10000" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm p-3 text-white">
                            </div>
                            <div>
                                <label for="staking-days" class="block text-sm font-medium text-gray-400">Staking Period (Days)</label>
                                <input type="number" id="staking-days" value="365" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm p-3 text-white">
                            </div>
                            <div>
                                <label for="expected-apy" class="block text-sm font-medium text-gray-400">Expected APY (%)</label>
                                <input type="number" id="expected-apy" value="42" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm p-3 text-white">
                            </div>
                            <button onclick="calculateSimulation()" class="w-full donut-primary text-white font-bold py-3 rounded-lg mt-4 transition duration-300 hover:opacity-80">
                                Run Simulation
                            </button>
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-gray-700">
                            <h4 class="text-xl font-semibold mb-3">Simulation Results:</h4>
                            <p class="text-lg">Projected DONUT Earned:</p>
                            <p class="text-3xl font-bold text-green-400" id="projected-donut">0.00 DONUT</p>
                            <p class="text-lg mt-4">Total Projected Value (USD):</p>
                            <p class="text-3xl font-bold text-yellow-400" id="projected-usd">$0.00</p>
                        </div>
                    </div>

                    <div class="bg-card p-8 rounded-xl shadow-2xl">
                        <h3 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-3">‚õΩ Gas Fee Estimator</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="gas-operation" class="block text-sm font-medium text-gray-400">Select Operation</label>
                                <select id="gas-operation" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" onchange="updateGasEstimate()">
                                    <option value="approve">Approve DONUT Token</option>
                                    <option value="stake">Stake DONUT (Miner)</option>
                                    <option value="claim">Claim Rewards</option>
                                    <option value="unstake">Unstake Tokens</option>
                                </select>
                            </div>
                            <div>
                                <label for="gas-price-gwei" class="block text-sm font-medium text-gray-400">Gas Price (Gwei)</label>
                                <input type="number" id="gas-price-gwei" value="0.1" min="0" step="0.01" class="mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" onchange="updateGasEstimate()">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-700 p-4 rounded-lg">
                                    <p class="text-xs text-gray-400 uppercase">Est. Gas Units</p>
                                    <p class="text-lg font-bold text-blue-400" id="gas-units">150,000</p>
                                </div>
                                <div class="bg-gray-700 p-4 rounded-lg">
                                    <p class="text-xs text-gray-400 uppercase">Total Cost (ETH)</p>
                                    <p class="text-lg font-bold text-yellow-400" id="gas-cost-eth">0.015 ETH</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-gray-700 rounded-lg border-l-4 border-donut-text">
                            <h4 class="text-sm font-semibold text-gray-300 mb-2">üí° Typical Gas Costs</h4>
                            <ul class="text-xs text-gray-400 space-y-1">
                                <li>üìå Approve Token: ~65,000 units</li>
                                <li>üöÄ Stake: ~120,000 units</li>
                                <li>üéÅ Claim: ~95,000 units</li>
                                <li>‚Ü©Ô∏è Unstake: ~100,000 units</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <section id="analytics" class="py-20 bg-gray-900">
            <div class="max-w-6xl mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-4">üìä Protocol Analytics & Key Metrics</h2>
                <p class="text-xl text-center text-gray-400 mb-12">
                    Transparency is key. Track the health, adoption, and distribution of the DONUT protocol in real-time.
                </p>

                <div class="grid md:grid-cols-3 gap-8 mb-12">
                    <div class="bg-card p-6 rounded-xl shadow-xl border-t-4 border-yellow-400">
                        <p class="text-lg font-medium text-gray-400">Active Miners (Last 30 Days)</p>
                        <p class="text-4xl font-extrabold text-yellow-400 mt-1">4,521</p>
                        <p class="text-sm text-gray-500 mt-2">Source: Subgraph Data</p>
                    </div>
                    <div class="bg-card p-6 rounded-xl shadow-xl border-t-4 border-blue-400">
                        <p class="text-lg font-medium text-gray-400">Next Social Distribution (Days)</p>
                        <p class="text-4xl font-extrabold text-blue-400 mt-1">15</p>
                        <p class="text-sm text-gray-500 mt-2">Status: Pending Snapshot</p>
                    </div>
                    <div class="bg-card p-6 rounded-xl shadow-xl border-t-4 border-green-400">
                        <p class="text-lg font-medium text-gray-400">Total Value Locked (Staking)</p>
                        <p class="text-4xl font-extrabold text-green-400 mt-1">$8,412,093</p>
                        <p class="text-sm text-gray-500 mt-2">Source: Contract Reads</p>
                    </div>
                </div>

                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl">
                    <h3 class="text-2xl font-bold mb-4 text-center">DONUT Analytics from Dune</h3>
                    <div id="dune-widget" class="w-full h-96 rounded-lg bg-gray-700 flex items-center justify-center overflow-auto">
                        <p class="text-gray-400">Loading Dune Analytics...</p>
                    </div>
                    
                    <div class="text-center mt-6">
                        <a href="https://dune.com/xyk/donut-company?theme=dark" target="_blank" class="text-lg font-bold donut-primary py-3 px-8 rounded-lg transition duration-300 hover:opacity-80">
                            View Full Dashboard on Dune ‚Üí
                        </a>
                    </div>
                </div>

            </div>
        </section>

        <section id="referral" class="py-20 bg-gray-800">
            <div class="max-w-4xl mx-auto px-4 text-center">
                <h2 class="text-4xl font-bold mb-4">ü§ù Share the Sweetness: <span class="donut-text">Earn 5% Bonus Fees</span></h2>
                <p class="text-xl text-gray-400 mb-10">
                    Refer friends to start DONUT mining or staking and earn a **5% bonus** calculated from *their* earned rewards, forever. Their rewards are **not** affected.
                </p>

                <div class="bg-card p-8 rounded-2xl shadow-2xl border-2 border-donut-text/50">
                    <h3 class="text-2xl font-semibold mb-6">Your Personal Referral Link</h3>
                    
                    <div class="flex flex-col sm:flex-row gap-4 mb-8">
                        <input type="text" id="referral-link-input" 
                               value="https://donuthub.com/?ref=0xAbcD1234..." 
                               readonly
                               class="flex-grow bg-gray-700 border border-gray-600 rounded-lg p-3 text-white truncate focus:outline-none focus:ring-2 focus:ring-donut-text"
                               aria-label="Your unique referral link">
                        
                        <button onclick="copyReferralLink()" id="copy-button"
                                class="w-full sm:w-auto donut-primary text-white font-bold py-3 px-6 rounded-lg transition duration-300 hover:opacity-80 flex items-center justify-center">
                            <span id="copy-text">üìã Copy Link</span>
                        </button>
                    </div>

                    <div class="text-gray-400 mb-6 flex justify-center space-x-4">
                        <a href="#" class="hover:donut-text transition duration-150">Twitter</a>
                        <span class="text-gray-600">|</span>
                        <a href="#" class="hover:donut-text transition duration-150">Telegram</a>
                        <span class="text-gray-600">|</span>
                        <a href="#" class="hover:donut-text transition duration-150">Email</a>
                    </div>
                    
                    <div class="pt-6 border-t border-gray-700">
                        <h3 class="text-2xl font-semibold mb-6">Referral Earnings Dashboard</h3>
                        
                        <div class="grid grid-cols-3 gap-6">
                            <div class="p-4 bg-gray-700 rounded-lg">
                                <p class="text-xs text-gray-400 uppercase">Total Referrals</p>
                                <p class="text-3xl font-bold donut-text" id="total-referrals">18</p>
                            </div>
                            <div class="p-4 bg-gray-700 rounded-lg">
                                <p class="text-xs text-gray-400 uppercase">DONUT Earned (Unclaimed)</p>
                                <p class="text-3xl font-bold text-yellow-400" id="unclaimed-donut">1,250</p>
                            </div>
                            <div class="p-4 bg-gray-700 rounded-lg">
                                <p class="text-xs text-gray-400 uppercase">Total Value (USD)</p>
                                <p class="text-3xl font-bold text-green-400" id="unclaimed-usd">$6.63</p>
                            </div>
                        </div>

                        <button class="w-full mt-6 bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 hover:bg-green-700 disabled:opacity-50" disabled>
                            Claim Referral Rewards (0.00 DONUT)
                        </button>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 mt-12 py-10 text-gray-400">
        <div class="max-w-7xl mx-auto px-4">
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-sm">
                
                <div>
                    <h4 class="text-white font-semibold mb-4 text-lg border-b border-gray-700 pb-2">üç© Protocol</h4>
                    <ul>
                        <li class="mb-2"><a href="#how-it-works" class="hover:donut-text transition duration-200">How It Works</a></li>
                        <li class="mb-2"><a href="#tools" class="hover:donut-text transition duration-200">Mining Tools & Simulator</a></li>
                        <li class="mb-2"><a href="#analytics" class="hover:donut-text transition duration-200">Protocol Analytics</a></li>
                        <li class="mb-2"><a href="#referral" class="hover:donut-text transition duration-200">Referral Program</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-white font-semibold mb-4 text-lg border-b border-gray-700 pb-2">üåê Ecosystem</h4>
                    <ul>
                        <li class="mb-2"><a href="https://www.reddit.com/r/ethtrader/" target="_blank" class="hover:donut-text transition duration-200">r/EthTrader (Social Mining)</a></li>
                        <li class="mb-2"><a href="[Link to DONUT Snapshot Space]" target="_blank" class="hover:donut-text transition duration-200">Governance & Voting</a></li>
                        <li class="mb-2"><a href="https://dune.com/xyk/donut-company?theme=dark" target="_blank" class="hover:donut-text transition duration-200">Dune Metrics Dashboard</a></li>
                        <li class="mb-2"><a href="#frontends" class="hover:donut-text transition duration-200">All Frontends & DApps</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-white font-semibold mb-4 text-lg border-b border-gray-700 pb-2">üõ†Ô∏è Technical</h4>
                    <ul>
                        <li class="mb-2"><a href="[Link to Official Docs/Whitepaper]" class="hover:donut-text transition duration-200">Docs / Whitepaper</a></li>
                        <li class="mb-2"><a href="https://github.com/Heesho/donut-miner" target="_blank" class="hover:donut-text transition duration-200">Smart Contracts (GitHub)</a></li>
                        <li class="mb-2"><a href="https://arbiscan.io/token/0xAE4a37d554C6D6F3E398546d8566B25052e0169C" target="_blank" class="hover:donut-text transition duration-200">DONUT Token (0xAE4a37...)</a></li>
                        <li class="mb-2"><a href="https://arbiscan.io/address/0xF69614F4Ee8D4D3879dd53d5A039eB3114C794F6" target="_blank" class="hover:donut-text transition duration-200">DONUT Miner (0xF69614...)</a></li>
                        <li class="mb-2"><a href="https://arbiscan.io/token/0xD1DbB2E56533C55C3A637D13C53aeEf65c5D5703" target="_blank" class="hover:donut-text transition duration-200">DONUT-ETH LP (0xD1DbB2...)</a></li>
                        <li class="mb-2"><a href="https://arbiscan.io/address/0x7a85CA4b4E15df2a7b927Fa56edb050d2399B34c" target="_blank" class="hover:donut-text transition duration-200">Multicall (0x7a85CA...)</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="text-white font-semibold mb-4 text-lg border-b border-gray-700 pb-2">‚öñÔ∏è Legal & Community</h4>
                    <ul>
                        <li class="mb-2"><a href="#" class="hover:donut-text transition duration-200">Terms of Service</a></li>
                        <li class="mb-2"><a href="#" class="hover:donut-text transition duration-200">Privacy Policy</a></li>
                        <li class="mb-2"><a href="#" class="hover:donut-text transition duration-200">Audit Reports</a></li>
                        <li class="mb-2"><a href="#" class="hover:donut-text transition duration-200">Discord / Support</a></li>
                    </ul>
                </div>

            </div>

            <div class="mt-10 pt-6 border-t border-gray-700 text-center text-xs text-gray-500">
                <p>&copy; 2025 DONUT Protocol Mining Hub. | Built by the community. | *All addresses linked above are external resources.</p>
                <p class="mt-1">Decentralized finance carries risks. Do your own research (DYOR).</p>
            </div>

        </div>
    </footer>
    
    <script>
        // --- Contract & Transaction Configuration ---
        // ‚ö†Ô∏è Fill these in with your actual contract details
        const DONUT_TOKEN_ADDRESS = '0xAE4a37d554C6D6F3E398546d8566B25052e0169C'; // DONUT token on Arbitrum
        const STAKING_CONTRACT_ADDRESS = '0xF69614F4Ee8D4D3879dd53d5A039eB3114C794F6'; // DONUT Miner contract
        const STAKING_CONTRACT_ABI = [
            'function stake(uint256 amount, uint256 period) external',
            'function startMining(uint256 amount, uint256 period) external'
        ];
        const TOKEN_ABI = [
            'function approve(address spender, uint256 amount) external returns (bool)',
            'function allowance(address owner, address spender) external view returns (uint256)',
            'function balanceOf(address account) external view returns (uint256)'
        ];

        // Network definitions for auto-switch
        const NETWORKS = {
            '42170': {
                name: 'Arbitrum Nova',
                chainId: 42170,
                rpcUrl: 'https://nova.arbitrum.io/rpc',
                blockExplorer: 'https://nova-explorer.arbitrum.io',
                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 }
            },
            '100': {
                name: 'Gnosis Chain',
                chainId: 100,
                rpcUrl: 'https://rpc.gnosischain.com',
                blockExplorer: 'https://gnosisscan.io',
                nativeCurrency: { name: 'xDAI', symbol: 'xDAI', decimals: 18 }
            }
        };

        let currentNetworkId = '42170'; // Default to Arbitrum Nova

        // --- Global Variables (Simulated Live Data) ---
        let currentDonutPrice = 0.0053; 
        // The initial DONUT price is used for the USD calculation

        // --- Gas Estimation Logic ---
        const GAS_ESTIMATES = {
            approve: 65000,
            stake: 120000,
            claim: 95000,
            unstake: 100000
        };

        async function updateGasEstimate() {
            const operation = document.getElementById('gas-operation').value;
            const gasPriceGwei = parseFloat(document.getElementById('gas-price-gwei').value) || 0.1;
            const gasUnits = GAS_ESTIMATES[operation] || 100000;

            // Calculate cost in ETH (Gwei * Gas Units / 1e9)
            const gasCostEth = (gasPriceGwei * gasUnits) / 1e9;
            const currentPriceUsd = currentDonutPrice; // Use DONUT price for reference

            // Update display
            document.getElementById('gas-units').textContent = gasUnits.toLocaleString();
            document.getElementById('gas-cost-eth').textContent = `${gasCostEth.toFixed(6)} ETH`;
        }

        // Initial gas calculation on load
        window.addEventListener('DOMContentLoaded', () => {
            updateGasEstimate();
        });

        // --- Simulation Calculation Function ---
        function calculateSimulation() {
            // 1. Get user inputs
            const initialDonut = parseFloat(document.getElementById('initial-donut').value);
            const stakingDays = parseFloat(document.getElementById('staking-days').value);
            // Convert APY to a decimal rate
            const annualRate = parseFloat(document.getElementById('expected-apy').value) / 100;

            // Check for valid inputs
            if (isNaN(initialDonut) || isNaN(stakingDays) || isNaN(annualRate) || initialDonut <= 0) {
                alert("Please enter valid positive numbers for the simulation.");
                return;
            }

            // --- Compound Interest Formula (Simplified Daily Compounding) ---
            const compoundingFrequency = 365;
            const timeInYears = stakingDays / 365;

            const totalDonut = initialDonut * Math.pow((1 + annualRate / compoundingFrequency), (compoundingFrequency * timeInYears));
            
            // Calculate the earned DONUT
            const projectedDonutEarned = totalDonut - initialDonut;
            const projectedUsdValue = totalDonut * currentDonutPrice; // Changed to total value of staked + earned

            // 2. Display Results
            document.getElementById('projected-donut').textContent = `${projectedDonutEarned.toFixed(2).toLocaleString()} DONUT`;
            document.getElementById('projected-usd').textContent = `$${(projectedUsdValue).toFixed(2).toLocaleString()}`;
        }

        // --- Referral Copy Logic ---
        function copyReferralLink() {
            const linkInput = document.getElementById('referral-link-input');
            const copyButton = document.getElementById('copy-button');
            const copyText = document.getElementById('copy-text');

            // 1. Select and copy the text
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(linkInput.value);

            // 2. Provide user feedback
            copyText.textContent = '‚úÖ Copied!';
            
            // Reset the button text after a short delay
            setTimeout(() => {
                copyText.textContent = 'üìã Copy Link';
            }, 2000); 
        }

        // --- Wallet Connect Logic ---
        function shortenAddress(address) {
            if (!address) return '';
            return address.slice(0,6) + '...' + address.slice(-4);
        }

        // track connected address
        let currentAddress = null;

        async function connectWallet() {
            if (!window.ethereum) {
                if (confirm('No Web3 wallet detected. Install MetaMask?')) {
                    window.open('https://metamask.io/download.html', '_blank');
                }
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (accounts && accounts.length > 0) {
                    updateConnectButton(accounts[0]);
                    currentAddress = accounts[0];
                }

                // show chainId in title for quick debugging
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                const btn = document.getElementById('connect-wallet-btn');
                if (btn) btn.title = (btn.title ? btn.title + ' ‚Äî ' : '') + chainId;
            } catch (err) {
                console.error('connectWallet error', err);
                alert('Could not connect wallet: ' + (err.message || err));
            }
        }

        function updateConnectButton(address) {
            const btn = document.getElementById('connect-wallet-btn');
            if (!btn) return;
            if (address) {
                btn.textContent = shortenAddress(address);
                btn.classList.remove('donut-primary');
                btn.classList.add('bg-gray-700');
                btn.setAttribute('title', address);
                currentAddress = address;
            } else {
                btn.textContent = 'Connect Wallet';
                btn.classList.add('donut-primary');
                btn.classList.remove('bg-gray-700');
                btn.removeAttribute('title');
                currentAddress = null;
            }
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                updateConnectButton(null);
            } else {
                updateConnectButton(accounts[0]);
            }
        }

        if (window.ethereum) {
            window.ethereum.on('accountsChanged', handleAccountsChanged);
            window.ethereum.on('chainChanged', (chainId) => {
                const btn = document.getElementById('connect-wallet-btn');
                if (btn) {
                    btn.title = (btn.title ? btn.title.split(' ‚Äî ')[0] + ' ‚Äî ' : '') + chainId;
                }
            });
        }

        // --- Start Mining Button Handlers ---
        function handleStartMiningClick() {
            // If wallet not connected, prompt to connect
            if (!currentAddress) {
                const connect = confirm('You need to connect a wallet to start mining. Connect now?');
                if (connect) {
                    connectWallet();
                    // wait briefly and then open modal if connected
                    setTimeout(() => {
                        if (currentAddress) showMiningModal();
                    }, 800);
                }
                return;
            }

            showMiningModal();
        }

        function showMiningModal() {
            const modal = document.getElementById('mining-modal');
            const form = document.getElementById('mining-form');
            const notice = document.getElementById('mining-notice');
            if (!modal) return;
            modal.classList.remove('hidden');
            // show form if connected
            if (currentAddress) {
                form.classList.remove('hidden');
                notice.textContent = '';
            } else {
                form.classList.add('hidden');
                notice.textContent = 'Please connect your wallet to continue.';
            }
        }

        function closeMiningModal() {
            const modal = document.getElementById('mining-modal');
            if (!modal) return;
            modal.classList.add('hidden');
        }

        async function performMiningAction() {
            const amount = parseFloat(document.getElementById('mining-amount').value);
            const period = parseInt(document.getElementById('mining-period').value, 10);
            const notice = document.getElementById('mining-notice');
            const networkId = document.getElementById('network-select').value;

            if (!currentAddress) {
                alert('Wallet not connected.');
                return;
            }
            if (isNaN(amount) || amount <= 0) {
                alert('Enter a positive amount.');
                return;
            }
            if (isNaN(period) || period <= 0) {
                alert('Enter a valid staking period.');
                return;
            }
            if (!STAKING_CONTRACT_ADDRESS || STAKING_CONTRACT_ADDRESS === '0x') {
                alert('Staking contract address not set.');
                return;
            }

            // Ensure correct network
            notice.textContent = 'Switching to network...';
            const switched = await ensureNetwork(networkId);
            if (!switched) {
                notice.textContent = 'Network switch failed.';
                return;
            }

            notice.textContent = 'Preparing transaction...';
            try {
                const provider = new ethers.BrowserProvider(window.ethereum);
                const signer = await provider.getSigner();
                // Approve DONUT token
                const token = new ethers.Contract(DONUT_TOKEN_ADDRESS, TOKEN_ABI, signer);
                const staking = new ethers.Contract(STAKING_CONTRACT_ADDRESS, STAKING_CONTRACT_ABI, signer);
                const decimals = 18; // DONUT decimals
                const amountWei = ethers.parseUnits(amount.toString(), decimals);

                // Check allowance
                const allowance = await token.allowance(currentAddress, STAKING_CONTRACT_ADDRESS);
                if (allowance < amountWei) {
                    notice.textContent = 'Approving DONUT token...';
                    const approveTx = await token.approve(STAKING_CONTRACT_ADDRESS, amountWei);
                    notice.textContent = 'Waiting for approval...';
                    await approveTx.wait();
                }

                // Call staking contract
                notice.textContent = 'Sending mining transaction...';
                let tx;
                if (staking.stake) {
                    tx = await staking.stake(amountWei, period);
                } else if (staking.startMining) {
                    tx = await staking.startMining(amountWei, period);
                } else {
                    throw new Error('Staking contract method not found.');
                }
                notice.textContent = 'Waiting for confirmation...';
                await tx.wait();
                notice.textContent = 'Mining started ‚úÖ ‚Äî Tx: ' + tx.hash;
                setTimeout(() => {
                    closeMiningModal();
                }, 1800);
            } catch (err) {
                console.error(err);
                notice.textContent = 'Failed to start mining: ' + (err.message || err);
            }
        }

        // --- Initial Setup (Load data on page load) ---
        window.onload = function() {
            // Display current price
            document.getElementById('donut-price').textContent = `$${currentDonutPrice.toFixed(4)}`;
            // Run simulator once to show initial values
            calculateSimulation(); 
            // Referral USD calculation (uses the simulated price)
            const unclaimedDonut = 1250; // Value hardcoded in HTML
            const unclaimedUsdValue = unclaimedDonut * currentDonutPrice;
            document.getElementById('unclaimed-usd').textContent = `$${unclaimedUsdValue.toFixed(2)}`;

            // Animate cards (fall-in) when they enter viewport
            const allCards = document.querySelectorAll('.bg-card');
            allCards.forEach(card => card.classList.add('fall-in'));
            const observer = new window.IntersectionObserver((entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.7 });
            allCards.forEach(card => observer.observe(card));

            // Typewriter effect for all major headings
            function typewriterEffect(el, text, speed=38, approval=false) {
                el.textContent = '';
                el.classList.add('typewriter');
                let idx = 0;
                function typeNext() {
                    if (idx <= text.length) {
                        el.textContent = text.slice(0, idx);
                        idx++;
                        setTimeout(typeNext, idx < text.length ? speed : 600);
                    } else {
                        el.classList.remove('typewriter');
                        el.textContent = text;
                        if (approval) {
                            // Add approval animation (checkmark)
                            const check = document.createElement('span');
                            check.textContent = ' ‚úÖ';
                            check.style.color = '#FF7F50';
                            check.style.fontWeight = 'bold';
                            el.appendChild(check);
                        }
                    }
                }
                typeNext();
            }

            // Hero heading: playful donut theme
            const heroH1 = document.querySelector('#hero h1');
            if (heroH1) {
                typewriterEffect(heroH1, 'üç© Welcome to DONUT ‚Äî The Fun Protocol Mining Hub!', 38, true);
            }

            // Other major headings
            document.querySelectorAll('h2.text-4xl, h3.text-2xl').forEach((el, i) => {
                if (el.textContent && el.textContent.length > 0) {
                    setTimeout(() => {
                        typewriterEffect(el, el.textContent, 22 + i*7, i % 2 === 0);
                    }, 800 + i*300);
                }
            });

            // Load Dune Analytics data
            loadDuneAnalytics();
        }

        // --- Dune Analytics Integration ---
        async function loadDuneAnalytics() {
            try {
                const widget = document.getElementById('dune-widget');
                
                // Skip if no API key available - show fallback message instead
                const duneApiKey = localStorage.getItem('duneApiKey') || '';
                
                if (!duneApiKey) {
                    widget.innerHTML = `<div class="p-6 text-center">
                        <p class="text-gray-400 mb-4">Enter your Dune API Key to load live analytics data</p>
                        <button onclick="promptDuneApiKey()" class="donut-primary text-white font-bold py-2 px-6 rounded-lg">
                            üîë Add API Key
                        </button>
                    </div>`;
                    return;
                }
                
                // CSV URL with API key
                const csvUrl = `https://api.dune.com/api/v1/query/6231837/results/csv?api_key=${duneApiKey}`;
                
                // Fetch CSV data
                const response = await fetch(csvUrl, {
                    headers: { 'Accept': 'text/csv' }
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                
                // Parse CSV into rows
                const rows = lines.slice(1).map(line => {
                    const values = line.split(',');
                    return headers.reduce((obj, header, i) => {
                        obj[header.trim()] = values[i] ? values[i].trim() : 'N/A';
                        return obj;
                    }, {});
                });
                
                // Build HTML table from CSV data
                let html = '<div class="w-full h-full p-4 bg-gray-700 rounded-lg overflow-x-auto">';
                html += '<table class="w-full text-sm text-left">';
                html += '<thead class="bg-gray-800"><tr>';
                
                // Headers
                headers.forEach(header => {
                    html += `<th class="px-3 py-2 text-gray-300 font-semibold">${header}</th>`;
                });
                html += '</tr></thead><tbody>';
                
                // Data rows (limit to first 10 for display)
                rows.slice(0, 10).forEach(row => {
                    html += '<tr class="border-t border-gray-600 hover:bg-gray-600">';
                    headers.forEach(header => {
                        html += `<td class="px-3 py-2 text-gray-200">${row[header]}</td>`;
                    });
                    html += '</tr>';
                });
                
                html += '</tbody></table></div>';
                widget.innerHTML = html;
            } catch (err) {
                console.error('Failed to load Dune data:', err);
                const widget = document.getElementById('dune-widget');
                widget.innerHTML = `<div class="p-4 text-center"><p class="text-red-400 mb-2">Failed to load Dune data</p><p class="text-gray-400 text-sm mb-4">Check your API key or try the dashboard link below</p><button onclick="promptDuneApiKey()" class="donut-primary text-white font-bold py-2 px-4 rounded-lg text-sm">Try Another Key</button></div>`;
            }
        }

        function promptDuneApiKey() {
            const key = prompt('Enter your Dune Analytics API Key:');
            if (key) {
                localStorage.setItem('duneApiKey', key);
                loadDuneAnalytics();
            }
        }
    </script>
</body>
</html>